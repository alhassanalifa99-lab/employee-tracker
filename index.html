<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The HR app</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>

<body>

    <div id="app" class="app-container">
        <!-- New Header -->
        <div class="app-header">
            <div class="app-logo">
                <span class="logo-text">ET</span>
            </div>
            <h1 class="app-title">Employee Tracker</h1>
        </div>

        <!-- Auth View -->
        <div id="view-auth" class="view active">
            <div class="card">
                <h2>Member Access</h2>

                <!-- GPS Status Indicator -->
                <div id="auth-gps-status"
                    style="margin-bottom:16px; padding:8px; border-radius:4px; font-size:0.85rem; background:rgba(255, 193, 7, 0.1); color:var(--accent-yellow); display:flex; align-items:center; justify-content:space-between;">
                    <span>üìç Waiting for GPS...</span>
                    <button onclick="app.watchLocation()"
                        style="background:none; border:1px solid var(--accent-yellow); color:var(--accent-yellow); padding:2px 6px; font-size:0.7rem; cursor:pointer; border-radius:4px;">RETRY</button>
                </div>

                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="auth-username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label>Company ID</label>
                    <input type="text" id="auth-company" placeholder="Enter Company ID">
                </div>
                <div class="form-group">
                    <label>Passcode (Optional)</label>
                    <input type="password" id="auth-passcode" placeholder="PIN if set">
                </div>
                <button class="btn btn-primary" onclick="app.login()">Login</button>
                <div
                    style="margin-top:16px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.1); text-align:center;">
                    <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:8px;">New User?</p>
                    <div style="display:flex; gap:8px; justify-content:center;">
                        <button class="btn btn-outline" style="padding:8px; font-size:0.8rem;"
                            onclick="app.showView('view-register-emp')">üë§ Register Employee</button>
                        <button class="btn btn-outline" style="padding:8px; font-size:0.8rem;"
                            onclick="app.showView('view-register')">üè¢ Register Company</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verify View -->
        <div id="view-verify" class="view">
            <div class="card" style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 16px;">‚úâÔ∏è</div>
                <h2>Verify Your Email</h2>
                <p style="color: var(--text-muted); margin-bottom: 24px;">
                    We sent a verification code to your contact.<br>
                    <small id="verify-hint">(Check console or alert for code)</small>
                </p>
                <div class="form-group">
                    <input type="text" id="verify-code" placeholder="Enter Code (e.g. 1234)"
                        style="text-align: center; letter-spacing: 4px; font-size: 1.2rem;">
                </div>
                <button class="btn btn-primary" onclick="app.verifyAccount()">Verify Account</button>
                <button class="btn btn-outline" onclick="app.logout()">Cancel</button>
            </div>
        </div>

        <!-- Register Company View -->
        <div id="view-register" class="view">
            <div class="card">
                <h2>Create Workspace</h2>
                <div class="form-group">
                    <label>Company Name</label>
                    <input type="text" id="reg-company-name" placeholder="e.g. Acme Corp">
                </div>
                <div class="form-group">
                    <label>Manager Username</label>
                    <input type="text" id="reg-manager-name" placeholder="Choose a username">
                </div>
                <button class="btn btn-primary" onclick="app.registerNewCompany()">Create Account</button>
                <button class="btn btn-outline" onclick="app.showView('view-auth')">Back to Login</button>
            </div>
        </div>

        <!-- Register Employee View -->
        <div id="view-register-emp" class="view">
            <div class="card">
                <h2>Employee Signup</h2>
                <p class="text-muted" style="margin-bottom:16px; font-size:0.9rem;">Create your account. Your manager
                    will then add you to the company using your username.</p>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="reg-emp-username-self" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label>Email (Optional)</label>
                    <input type="email" id="reg-emp-email-self" placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label>Phone Number (Mandatory if no Email)</label>
                    <input type="tel" id="reg-emp-phone-self" placeholder="+1 234 567 8900">
                </div>
                <div class="form-group">
                    <label>Create Passcode (Optional)</label>
                    <input type="password" id="reg-emp-passcode-self" placeholder="Set a login PIN" maxlength="6">
                </div>
                <button class="btn btn-primary" onclick="app.registerNewEmployeeUser()">Create Account</button>
                <button class="btn btn-outline" onclick="app.showView('view-auth')">Back to Login</button>
            </div>
        </div>

        <!-- Manager Dashboard -->
        <div id="view-manager" class="view">
            <!-- Site Management -->
            <div class="card">
                <h2>üè¢ Manage Sites</h2>
                <div class="form-group">
                    <label>Create New Worksite</label>
                    <p style="font-size:0.8rem; color: var(--text-muted); margin-bottom:8px;">Requires GPS to set
                        location.</p>
                    <div style="display:flex; gap:8px; flex-direction: column;">
                        <input type="text" id="new-site-name" placeholder="Site Name (e.g. Headquarters)">
                        <div id="manager-coords" class="coordinates-display" style="font-size: 0.8rem;">üìç Waiting for
                            GPS...</div>
                        <button class="btn btn-primary" onclick="app.createSite()">Set Location & Create</button>
                    </div>
                </div>
                <div id="site-list-display"></div>
            </div>

            <!-- Employee Registration -->
            <div class="card">
                <h2>‚ûï Add/Link Employee</h2>
                <div class="form-group">
                    <label>Assigned Worksite</label>
                    <select id="new-emp-site">
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Employee Username</label>
                    <input type="text" id="new-emp-username" placeholder="Existing username">
                </div>
                <div class="form-group">
                    <label>Employee Contact (Email or Phone)</label>
                    <input type="text" id="new-emp-contact" placeholder="Email or Phone">
                </div>
                <div class="form-group">
                    <label>Set Passcode (Optional)</label>
                    <input type="text" id="new-emp-passcode" placeholder="Login PIN" maxlength="6">
                </div>
                <button class="btn btn-primary" onclick="app.registerEmployee()">Link Employee</button>
            </div>

            <!-- My Team Management -->
            <div class="card">
                <h2>üë• My Team</h2>
                <div id="team-list-container">
                    <!-- Populated by JS -->
                    <p style="text-align:center; color: var(--text-muted);">No employees yet.</p>
                </div>
            </div>

            <!-- Activity Logs -->
            <div class="card" style="margin-top: 16px;">
                <h2>üìä Live Team Status</h2>
                <div id="team-status-display">
                    <!-- Javascript will populate this -->
                </div>
            </div>

            <div class="card" style="margin-top: 16px;">
                <h2>Activity Logs</h2>
                <div id="employee-list">
                    <!-- Employee items will populate here -->
                    <p style="color: var(--text-muted); font-size: 0.9rem;">No activity yet.</p>
                </div>
            </div>

            <button class="btn btn-outline" onclick="app.logout()" style="margin-top:16px;">Log Out</button>

            <div class="debug-controls">
                <div class="debug-title">üöß Dev Tools</div>
                <button class="btn btn-outline" style="font-size: 0.8rem; padding: 8px;"
                    onclick="app.debugSetLocation(app.currentPosition.lat + 0.005, app.currentPosition.lng)">
                    üöÄ Teleport Away (Test Auto-Checkout)
                </button>
            </div>
        </div>

        <!-- Employee Dashboard -->
        <div id="view-employee" class="view">
            <div class="card" style="text-align: center;">
                <h2>My Status</h2>
                <div class="status-indicator" id="emp-status-box">
                    <span id="emp-status-icon" class="status-icon">üõë</span>
                    <h3 id="emp-status-text">Checked Out</h3>
                    <p id="emp-timer" style="margin-top: 8px; font-weight: 600; display: none;">00:00:00</p>
                </div>

                <div class="form-group">
                    <label>Current Location</label>
                    <div id="emp-coords" class="coordinates-display">Getting GPS...</div>
                    <div id="debug-distance" style="font-size: 0.75rem; color: var(--accent-yellow); margin-top: 4px;">
                    </div>
                </div>

                <div id="emp-actions">
                    <button id="btn-checkin" class="btn btn-primary" onclick="app.checkIn()">‚úÖ Check In</button>
                    <button id="btn-checkout" class="btn btn-danger" onclick="app.checkOut()" style="display: none;">üõë
                        Check Out</button>
                </div>
                <button class="btn btn-outline" onclick="app.logout()">Log Out</button>

                <div class="debug-controls" style="margin-top: 24px;">
                    <div class="debug-title">üöß Dev Tools</div>
                    <button class="btn btn-outline" style="font-size: 0.8rem; padding: 8px;"
                        onclick="app.debugSetLocation(app.currentPosition.lat + 0.005, app.currentPosition.lng)">
                        üöÄ Teleport Away (Test Auto-Checkout)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>

</html>